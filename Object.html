<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Object - vgopher v0.1</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">BasicObject
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="Logging.html">Logging</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-get_something">#get_something</a>
    
    <li ><a href="#method-i-get_vcenter_data">#get_vcenter_data</a>
    
    <li ><a href="#method-i-qbuild_collection">#qbuild_collection</a>
    
    <li ><a href="#method-i-qbuild_object">#qbuild_object</a>
    
    <li ><a href="#method-i-qbuilder">#qbuilder</a>
    
    <li ><a href="#method-i-qoutput">#qoutput</a>
    
    <li ><a href="#method-i-redis_db_setup">#redis_db_setup</a>
    
    <li ><a href="#method-i-set_vars">#set_vars</a>
    
    <li ><a href="#method-i-splat_sort">#splat_sort</a>
    
    <li ><a href="#method-i-tunnelvc">#tunnelvc</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Object">
  <h1 id="class-Object" class="class">
    class Object
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="CONFIG_DIR">CONFIG_DIR
        
        <dd>
        
      
        <dt id="DATA_DIR">DATA_DIR
        
        <dd>
        
      
        <dt id="LOG_DIR">LOG_DIR
        
        <dd>
        
      
        <dt id="LOG_LEVEL">LOG_LEVEL
        
        <dd>
        
      
        <dt id="LOG_MAX_FILES">LOG_MAX_FILES
        
        <dd>
        
      
        <dt id="LOG_MAX_SIZE">LOG_MAX_SIZE
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-get_something" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_something</span><span
            class="method-args">(*params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_something-source">
            <pre><span class="ruby-comment"># File bin/api.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_something</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>)
  <span class="ruby-ivar">@output</span> = <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@output</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_vcenter_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_vcenter_data</span><span
            class="method-args">(vdc,vc)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_vcenter_data-source">
            <pre><span class="ruby-comment"># File bin/vgopher.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_vcenter_data</span>(<span class="ruby-identifier">vdc</span>,<span class="ruby-identifier">vc</span>)
  <span class="ruby-comment"># todo: reconfigure to account that a gateway/tunnel may not be needed</span>
  <span class="ruby-comment"># vchost = @runtime_config[&#39;vc_connect_info&#39;][&#39;ip&#39;]</span>
  <span class="ruby-comment"># port = @runtime_config[&#39;vc_connect_info&#39;][&#39;port&#39;]</span>
  <span class="ruby-identifier">vc_password</span> = <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-string">&#39;vc_connect_info&#39;</span>][<span class="ruby-string">&#39;vc_password&#39;</span>]
  <span class="ruby-identifier">vc_user</span> = <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-string">&#39;vc_connect_info&#39;</span>][<span class="ruby-string">&#39;vc_user&#39;</span>]

  <span class="ruby-identifier">connect</span> = <span class="ruby-constant">VcenterConnect</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-comment">#vdc1 = Vdatacenter.find(name: vdc1).first</span>
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">to_vcenter</span>(<span class="ruby-identifier">vdc</span>,<span class="ruby-identifier">vc</span>,<span class="ruby-identifier">vc_user</span>,<span class="ruby-identifier">vc_password</span>)
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">get_vcenter_data</span>
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">dvs_output</span>
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">virt_machine_output</span>
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">hostsystem_output</span>
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">cluster_output</span>
  <span class="ruby-identifier">connect</span>.<span class="ruby-identifier">datastore_output</span>
  <span class="ruby-comment">#vcenter_name = vc.partition(&#39;.&#39;).shift.downcase</span>
  
  <span class="ruby-comment">#connect.get_vcenter_data</span>
  <span class="ruby-comment">#vdc1.update(latestupdate: Time.now.to_i)</span>
  <span class="ruby-constant">GatewayJump</span><span class="ruby-operator">::</span><span class="ruby-identifier">close_tunnel</span>
  <span class="ruby-identifier">connect</span> = []

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qbuild_collection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qbuild_collection</span><span
            class="method-args">(base_ohm_object,value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>build saerch for a collection</p>
          
          

          
          <div class="method-source-code" id="qbuild_collection-source">
            <pre><span class="ruby-comment"># File bin/api.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">qbuild_collection</span>(<span class="ruby-identifier">base_ohm_object</span>,<span class="ruby-identifier">value</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
    <span class="ruby-ivar">@base_ohm_object</span> = <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">value</span>).<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">objx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">objx</span> } }<span class="ruby-comment">#[0]</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@base_ohm_object</span> = <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qbuild_object" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qbuild_object</span><span
            class="method-args">(base_ohm_object,value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>build search for specific object or range of objects(regex)</p>
          
          

          
          <div class="method-source-code" id="qbuild_object-source">
            <pre><span class="ruby-comment"># File bin/api.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">qbuild_object</span>(<span class="ruby-identifier">base_ohm_object</span>,<span class="ruby-identifier">value</span>)

  <span class="ruby-identifier">tmp_base_ohm_object</span> = []

  <span class="ruby-comment"># unless the object type is an array or an Ohm List, use find method to query redis</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Ohm</span><span class="ruby-operator">::</span><span class="ruby-constant">List</span>)
    <span class="ruby-identifier">tmp_base_ohm_object</span> = <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># if the object type is an array and it contains more than 1 element, flatten the array</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">flatten!</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># if there wasn&#39;t anything found using find method(tmp_base_ohm_object.empty?), attempt to find the object using regex</span>
  <span class="ruby-identifier">tmp_base_ohm_object</span> = <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">value</span>) <span class="ruby-operator">===</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">name</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">tmp_base_ohm_object</span>.<span class="ruby-identifier">empty?</span>
  
  <span class="ruby-comment"># toss up an error no objects were found</span>
  <span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, <span class="ruby-node">&quot;unable to find #{value}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tmp_base_ohm_object</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-comment"># set the new base_ohm_object</span>
  <span class="ruby-ivar">@base_ohm_object</span> = <span class="ruby-identifier">tmp_base_ohm_object</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;qbuild_object #{value} #{base_ohm_object.count}&quot;</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qbuilder" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qbuilder</span><span
            class="method-args">(collections_objects)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="qbuilder-source">
            <pre><span class="ruby-comment"># File bin/api.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">qbuilder</span>(<span class="ruby-identifier">collections_objects</span>)
  
  <span class="ruby-ivar">@output</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = [] }
  
  <span class="ruby-comment"># an index match will yield Ohm::Set</span>
  <span class="ruby-ivar">@base_ohm_object</span> = <span class="ruby-ivar">@ohm_ob</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span>)
  <span class="ruby-comment"># a regexp match will yield an Array</span>
  <span class="ruby-ivar">@base_ohm_object</span> = <span class="ruby-ivar">@ohm_ob</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@object</span>) <span class="ruby-operator">===</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">name</span>} <span class="ruby-keyword">if</span> <span class="ruby-ivar">@base_ohm_object</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-comment"># return error if unable to find anything</span>
  <span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, <span class="ruby-node">&quot;unable to find #{@object}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@base_ohm_object</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-comment"># unless there aren&#39;t any collections or objects to search, build the query</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">collections_objects</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/col|obj/</span> }.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">collections_objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/col/</span>
        <span class="ruby-identifier">qbuild_collection</span>(<span class="ruby-ivar">@base_ohm_object</span>,<span class="ruby-identifier">value</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/obj/</span>
        <span class="ruby-identifier">qbuild_object</span>(<span class="ruby-ivar">@base_ohm_object</span>,<span class="ruby-identifier">value</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># send to output method</span>
  <span class="ruby-identifier">qoutput</span>(<span class="ruby-ivar">@base_ohm_object</span>, <span class="ruby-identifier">collections_objects</span>[<span class="ruby-value">:attribs</span>])

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qoutput" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qoutput</span><span
            class="method-args">(base_ohm_object, attribs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>process sets/arrays generated from qbuilder for output.</p>
          
          

          
          <div class="method-source-code" id="qoutput-source">
            <pre><span class="ruby-comment"># File bin/api.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">qoutput</span>(<span class="ruby-identifier">base_ohm_object</span>, <span class="ruby-identifier">attribs</span>)
  <span class="ruby-comment"># if no attributes were defined, set the base attribs to return for an object/group</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">attribs</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">attribs</span> = [<span class="ruby-string">&#39;overallstatus&#39;</span>, <span class="ruby-string">&#39;accessible&#39;</span>, <span class="ruby-string">&#39;uuid&#39;</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">flatten!</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">base_ohm_object</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@output</span>[<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">atr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">atr</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">attribs</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">atr</span>.<span class="ruby-identifier">to_s</span>) }
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-redis_db_setup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">redis_db_setup</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="redis_db_setup-source">
            <pre><span class="ruby-comment"># File bin/vgopher.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">redis_db_setup</span>
  <span class="ruby-keyword">begin</span>
  <span class="ruby-comment"># connect to redis db # the corresponds with client # in config.ini</span>
  <span class="ruby-constant">Ohm</span>.<span class="ruby-identifier">redis</span> = <span class="ruby-constant">Redic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@runtime_config</span>[<span class="ruby-value">:redisdb</span>][<span class="ruby-value">:rsocketp</span>])
  
  <span class="ruby-ivar">@client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span>  <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-value">:redisdb</span>][<span class="ruby-value">:name</span>])

  <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-value">:vcenters</span>].<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vdc</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Vdatacenter</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{vdc}&quot;</span>, <span class="ruby-identifier">client</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@client</span>, <span class="ruby-identifier">latestupdate</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Ohm</span><span class="ruby-operator">::</span><span class="ruby-constant">UniqueIndexViolation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fault</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;#{fault}&quot;</span>
    <span class="ruby-identifier">exit</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_vars" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_vars</span><span
            class="method-args">(options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_vars-source">
            <pre><span class="ruby-comment"># File bin/vgopher.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_vars</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@options</span>[<span class="ruby-value">:client</span>].<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;unable to load client config for: #{@options[:client]}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># load client config_file</span>
  <span class="ruby-ivar">@runtime_config</span> = <span class="ruby-constant">IniParse</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">CONFIG_DIR</span>, <span class="ruby-ivar">@options</span>[<span class="ruby-value">:client</span>], <span class="ruby-string">&#39;config.ini&#39;</span>)) )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-splat_sort" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">splat_sort</span><span
            class="method-args">(splat_vals)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="splat_sort-source">
            <pre><span class="ruby-comment"># File bin/api.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">splat_sort</span>(<span class="ruby-identifier">splat_vals</span>)

  <span class="ruby-comment"># get all valid attribute/collection terms for base object_bucket</span>
  <span class="ruby-identifier">bucket_words</span> = <span class="ruby-identifier">@@word_buckets</span>[<span class="ruby-value">0</span>][<span class="ruby-ivar">@object_bucket</span>].<span class="ruby-identifier">values_at</span>(<span class="ruby-value">:attributes</span>, <span class="ruby-value">:collections</span>, <span class="ruby-value">:lists</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>

  <span class="ruby-comment"># unless the first term in the array is an attribute or collection, error out</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">bucket_words</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">splat_vals</span>[<span class="ruby-value">0</span>])
    <span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, <span class="ruby-node">&quot;first value must be an attribute or collection of #{@object_bucket} - #{@object} select from #{bucket_words}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># create an empty hash which will contain sorted elements. </span>
  <span class="ruby-identifier">collections_objects</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = [] }

  <span class="ruby-comment"># unless the first term in the array is an attribute, assume it is either a collection or object..begin sorting.</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">@@word_buckets</span>[<span class="ruby-value">0</span>][<span class="ruby-ivar">@object_bucket</span>][<span class="ruby-value">:attributes</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">splat_vals</span>[<span class="ruby-value">0</span>])

    <span class="ruby-comment"># reverse the array, as we are looking for the last collection to base from</span>
    <span class="ruby-identifier">splat_vals</span>.<span class="ruby-identifier">reverse!</span>

    <span class="ruby-comment"># grabs all the keys that are &quot;collections&quot;, puts them in a list to compare to</span>
    <span class="ruby-identifier">collection_words</span> = <span class="ruby-identifier">@@word_buckets</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">values</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">obj_bucket</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj_bucket</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-value">:collections</span>, <span class="ruby-value">:lists</span>) }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
    
    <span class="ruby-comment"># detect the first collection term in the reversed array</span>
    <span class="ruby-identifier">collec1</span> = <span class="ruby-identifier">splat_vals</span>.<span class="ruby-identifier">each_with_index</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span>,<span class="ruby-identifier">index</span><span class="ruby-operator">|</span> <span class="ruby-identifier">collection_words</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">value</span>) }

    <span class="ruby-comment"># unless there was no collection specified, sort collections from objects from attributes based on the order they appear in the array</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">collec1</span>.<span class="ruby-identifier">nil?</span>

      <span class="ruby-identifier">wordz</span> = <span class="ruby-identifier">@@word_buckets</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">collec1</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">chop</span>]
      <span class="ruby-identifier">obj_idx</span> = <span class="ruby-value">0</span>
      <span class="ruby-identifier">col_idx</span> = <span class="ruby-value">0</span>

      <span class="ruby-comment"># anything after /:client/:object_bucket/:object follows this pattern;</span>
      <span class="ruby-comment"># /(collection|attribute)[0]/OBJECT[1]/(collection|attribute)[2]/OBJECT[3]/(collection|attribute)[4]...etc</span>
      <span class="ruby-comment"># attributes will have an even number index in the array, while the query OBJECT will have an odd index</span>
      <span class="ruby-comment"># e.g. /client/object_bucket/object/collection/object/collection/object/attribute/attribute would be</span>
      <span class="ruby-comment"># collection1/object2/  collection2  /object3/attribute1/attribute2 - where collection2 takes over as the base_ohm_object to draw attributes from</span>
      <span class="ruby-identifier">splat_vals</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">collec1</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>).<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">index</span>.<span class="ruby-identifier">odd?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">collections_objects</span>[<span class="ruby-node">&quot;obj#{obj_idx += 1}&quot;</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">collections_objects</span>[<span class="ruby-node">&quot;col#{col_idx += 1}&quot;</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">left_side</span> = <span class="ruby-identifier">splat_vals</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">collec1</span>[<span class="ruby-value">1</span>])

      <span class="ruby-comment"># the last element in the left_side array will be the last collection, which will be the base for anything after</span>
      <span class="ruby-identifier">collections_objects</span>[<span class="ruby-node">&quot;col#{col_idx += 1}&quot;</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">left_side</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">-1</span>)
      
      <span class="ruby-comment"># if the new last word in the array is an attribute, add to the final attribs hash_array. </span>
      <span class="ruby-comment"># else, assume it is an object and everything after is an attribute</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">wordz</span>[<span class="ruby-value">:attributes</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">left_side</span>.<span class="ruby-identifier">last</span>)
        <span class="ruby-identifier">collections_objects</span>[<span class="ruby-value">:attribs</span>] = <span class="ruby-identifier">left_side</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">collections_objects</span>[<span class="ruby-node">&quot;obj#{obj_idx += 1}&quot;</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">left_side</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">-1</span>)
        <span class="ruby-identifier">collections_objects</span>[<span class="ruby-value">:attribs</span>] = <span class="ruby-identifier">left_side</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># check to make sure all attrib terms are valid</span>
      <span class="ruby-identifier">collections_objects</span>[<span class="ruby-value">:attribs</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attrib</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">collections_objects</span>[<span class="ruby-value">:attribs</span>].<span class="ruby-identifier">empty?</span>
          <span class="ruby-keyword">unless</span> <span class="ruby-identifier">wordz</span>[<span class="ruby-value">:attributes</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">attrib</span>)
            <span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, <span class="ruby-node">&quot;invalid attribute #{attrib}. select from #{wordz[:attributes]}&quot;</span> 
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># check to make sure all collection words are valid</span>
      <span class="ruby-identifier">collections_objects</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/col/</span>}.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">collection</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">collection_words</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">collection</span>[<span class="ruby-value">1</span>])
          <span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, <span class="ruby-node">&quot;invalid collection #{collection}&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># remove any hash pair if value is nill as that just mucks everything up. </span>
    <span class="ruby-identifier">collections_objects</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> }
    <span class="ruby-identifier">qbuilder</span>(<span class="ruby-identifier">collections_objects</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-ivar">@output</span>

  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># regardless of anything, process any given attributes. make sure they are valid before sending to query builder</span>
  <span class="ruby-identifier">splat_vals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attrib</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">bucket_words</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">attrib</span>)
      <span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, <span class="ruby-node">&quot;invalid attribute #{attrib}... select from #{@@word_buckets[0][@object_bucket][:attributes]}&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">collections_objects</span>[<span class="ruby-value">:attribs</span>] = <span class="ruby-identifier">splat_vals</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">qbuilder</span>(<span class="ruby-identifier">collections_objects</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@output</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tunnelvc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tunnelvc</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="tunnelvc-source">
            <pre><span class="ruby-comment"># File bin/vgopher.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tunnelvc</span>
  <span class="ruby-comment"># make call to sf_firewall before here</span>
  <span class="ruby-constant">GatewayJump</span><span class="ruby-operator">::</span><span class="ruby-identifier">forward_gateway</span>(
    <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-string">&#39;gateway&#39;</span>][<span class="ruby-string">&#39;host&#39;</span>], 
    <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-string">&#39;gateway&#39;</span>][<span class="ruby-string">&#39;ip_user&#39;</span>], 
    <span class="ruby-ivar">@runtime_config</span>[<span class="ruby-string">&#39;gateway&#39;</span>][<span class="ruby-string">&#39;ip_password&#39;</span>]
    )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

